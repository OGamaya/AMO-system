{# Load the tag library #}
{% load staticfiles %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %} MerkaOrgánico {% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <script>
        var rolUser;
        function logout(){
            $.getJSON("http://127.0.0.1:8000/logout").done(function (data) {
                if(data.mensaje == "ok"){
                    location.reload();
                }
                else {
                    alert("Hubo un error.")
                }
            })
        }

      $(document).ready(function () {

          $("#mess-error").hide();

          $("#form-login").submit(function (event) {
              $.ajax({
                  type: "POST",
                  url: "http://amo-system.herokuapp.com:8000/login/",
                  data: JSON.stringify({ username: $('#inputUsername').val(), password: $('#inputPassword').val() }),
                  contentType: "application/json; charset=utf-8",
                  dataType: "json",
                  success: function(data){
                      $.each(data,function (i,item) {
                        if (item.mensaje == 'OK')
                        {
                            rolUser=item.rol;
                            window.location = "{% url 'comun:index' %}";
                        }
                        else
                        {
                            $("#mess-error").show();
                            $("#mensaje").html(item.mensaje);
                        }
                      })
                  },
                  failure: function (errMsg) {
                      alert('Hubo error!');
                  }
              });
              event.preventDefault();
          });

          $.getJSON("http://amo-system.herokuapp.com:8000/isLogged/").done(function(data){
            if(data.mensaje == "no"){
                $("#cerrar_sesion").hide();
                $("#consultar_ofertas").hide();
                $("#ofertar").hide();
                $("#evaluar_ofertas").hide();
                $("#armar_catalogo").hide();
                $("#iniciar_sesion").show();
            }else{
                if(data.mensaje == "Productor"){
                     $("#consultar_ofertas").show();
                     $("#ofertar").show();
                     $("#cerrar_sesion").show();
                     $("#evaluar_ofertas").hide();
                     $("#armar_catalogo").hide();
                     $("#iniciar_sesion").hide();
                }else if(data.mensaje == "Administrador"){
                     $("#consultar_ofertas").hide();
                     $("#ofertar").hide();
                     $("#evaluar_ofertas").show();
                     $("#armar_catalogo").show();
                     $("#cerrar_sesion").show();
                     $("#iniciar_sesion").hide();
                }else if(data.mensaje == "Consumidor"){
                     $("#consultar_ofertas").hide();
                     $("#ofertar").hide();
                     $("#evaluar_ofertas").hide();
                     $("#armar_catalogo").hide();
                     $("#cerrar_sesion").show();
                     $("#iniciar_sesion").hide();
                }
          }});
      });

  </script>
</head>
<body id="page-top">
    {% block header %}
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="{% url 'comun:index' %}" >MerkaOrgánico</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
          <span class="navbar-toggler-icon"></span>
          <span class="navbar-toggler-icon"></span>
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item" id ="consultar_ofertas"><a class="nav-link" href="{% url 'productor:ver_ofertas' %}">Consultar Ofertas</a></li>
            <li class="nav-item" id ="ofertar"><a class="nav-link" href="{% url 'productor:ver_ofertas' %}">Ofertar</a></li>
            <li class="nav-item" id ="evaluar_ofertas"><a class="nav-link" href="{% url 'catalogo:evaluarOfertas' %}">Evaluar Ofertas</a></li>
            <li class="nav-item" id ="armar_catalogo"><a class="nav-link" href="{% url 'productor:ver_ofertas' %}">Armar Catálogo</a></li>
            <li class="nav-item" id="cerrar_sesion"><a href="#" class="nav-link" onclick="logout();"><i class="fa fa-fw fa-sign-out"></i>Cerrar Sesión</a></li>
            <li class="nav-item" id="iniciar_sesion"><a href="#" class="nav-link" data-toggle="modal" data-target="#modalLogin"><i class="fa fa-fw fa-sign-in"></i>Iniciar Sesión</a></li>
          </ul>
        </div>
      </div>
    </nav>
    {% endblock %}

    {% block content %}
     <header class="masthead">
      <div class="header-content" style="background-image:{% static 'img/header.jpg' %}">
        <div class="header-content-inner" >
          <h1 id="homeHeading" style="background-color: black">FRESCO + ORGANICO + SALUDABLE</h1>
          <hr>
          <p>Lo mejor del campo a la puerta de tu casa semana a semana</p>
          <a class="btn btn-primary btn-xl js-scroll-trigger" href="#about">Conoce el catálogo de productos de la semana</a>
        </div>
      </div>
    </header>
    {% endblock %}

    {% block footer %}

    <section id="contact">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 mx-auto text-center">
            <h2 class="section-heading">Comunícate con nosotros !</h2>
            <hr class="primary">
            <p>Si tienes dudas o comentarios, contáctanos</p>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-4 ml-auto text-center">
            <i class="fa fa-phone fa-3x sr-contact"></i>
            <p>123-456-6789</p>
          </div>
          <div class="col-lg-4 mr-auto text-center">
            <i class="fa fa-envelope-o fa-3x sr-contact"></i>
            <p>
              <a href="mailto:your-email@your-domain.com">feedback@uniandes.edu.co</a>
            </p>
          </div>
        </div>
      </div>

    </section>
         <!-- Modal -->
    <div class="modal fade" id="modalLogin" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header" style="height: 10px">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <form class="form-signin" method="post" id="form-login">
                        <div id="mess-error">
                            <div class="alert alert-danger">
                                <label for="mensaje" id="mensaje"></label>
                            </div>
                        </div>
                        <label for="inputUsername" class="sr-only">Usuario</label>
                        <input id="inputUsername" class="form-control" placeholder="Usuario" name="username" required autofocus ><br>
                        <label for="inputPassword" class="sr-only">Contraseña</label>
                        <input type="password" id="inputPassword" class="form-control" placeholder="Contraseña" name="password" required>
                        <br/>
                        <div class="mx-auto text-center">
                            <button class="btn btn-lg btn-outline" type="submit">Iniciar sesión</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    {% endblock %}
</body>
</html>