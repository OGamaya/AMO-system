{# Load the tag library #}
{% load staticfiles %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %} Merkorganico {% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap core CSS -->
    <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="{% static 'vendor/font-awesome/css/font-awesome.css' %}" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>

    <!-- Plugin CSS -->
    <link href="{% static 'vendor/magnific-popup/magnific-popup.css' %}" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="{% static 'css/creative.css' %}" rel="stylesheet">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/bootstrap-table.min.css">
    <script src="//code.jquery.com/jquery.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/bootstrap-table.min.js"></script>
    <script>
        var rolUser;
        function logout(){
            $.getJSON("http://127.0.0.1:8000/logout").done(function (data) {
                if(data.mensaje == "ok"){
                    location.reload();
                }
                else {
                    alert("Hubo un error.")
                }
            })
        }

      $(document).ready(function () {

          $("#mess-error").hide();

          $("#form-login").submit(function (event) {
              $.ajax({
                  type: "POST",
                  url: "http://127.0.0.1:8000/login/",
                  data: JSON.stringify({ username: $('#inputUsername').val(), password: $('#inputPassword').val() }),
                  contentType: "application/json; charset=utf-8",
                  dataType: "json",
                  success: function(data){
                      $.each(data,function (i,item) {
                        if (item.mensaje == 'OK')
                        {
                            rolUser=item.rol;
                            window.location = "{% url 'comun:index' %}";
                        }
                        else
                        {
                            $("#mess-error").show();
                            $("#mensaje").html(item.mensaje);
                        }
                      })
                  },
                  failure: function (errMsg) {
                      alert('Hubo error!');
                  }
              });
              event.preventDefault();
          });

          $.getJSON("http://127.0.0.1:8000/isLogged/").done(function(data){
            if(data.mensaje == "no"){
                $("#cerrar_sesion").hide();
                $("#iniciar_sesion").show();
                $("#catalogo_compras").show();
            }else{
                if(data.mensaje == "Consumidor"){
                     $("#cerrar_sesion").show();
                     $("#iniciar_sesion").hide();
                     $("#catalogo_compras").show();
                }
          }});
      });

  </script>
</head>
<body id="page-top">
    {% block header %}
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top navbar-shrink" id="mainNav">
      <div class="container">
        <a class="navbar-brand" href="{% url 'comun:index' %}">Mercado Orgánico</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item" id ="catalogo_compras"><a class="nav-link" href="{% url 'consumidor:catalogo_compras' %}">Comprar</a></li>
            <li class="nav-item" id="cerrar_sesion"><a href="#" class="nav-link" onclick="logout();"><i class="fa fa-fw fa-sign-out"></i>Cerrar Sesión</a></li>
            <li class="nav-item" id="iniciar_sesion"><a href="#" class="nav-link" data-toggle="modal" data-target="#modalLogin"><i class="fa fa-fw fa-sign-in"></i>Iniciar Sesión</a></li>
          </ul>
        </div>
      </div>
    </nav>
    {% endblock %}

    {% block content %}
     <header class="masthead">
      <div class="header-content" style="background-image:{% static 'img/header.jpg' %}">
        <div class="header-content-inner">
          <h1 id="homeHeading">FRESCO + ORGANICO + SALUDABLE</h1>
          <hr>
          <p>Lo mejor del campo a la puerta de tu casa semana a semana</p>
          <a class="btn btn-primary btn-xl js-scroll-trigger" href="#about">Conoce más</a>
        </div>
      </div>
    </header>
    {% endblock %}

    {% block footer %}

    <section id="contact">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 mx-auto text-center">
            <h2 class="section-heading">Tomémonos un café !</h2>
            <hr class="primary">
            <p>Cualquier duda, comentario o sugerencia con gusto será recibida</p>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-4 ml-auto text-center">
            <i class="fa fa-phone fa-3x sr-contact"></i>
            <p>123-456-6789</p>
          </div>
          <div class="col-lg-4 mr-auto text-center">
            <i class="fa fa-envelope-o fa-3x sr-contact"></i>
            <p>
              <a href="mailto:your-email@your-domain.com">feedback@uniandes.edu.co</a>
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Bootstrap core JavaScript -->
    <script src="{% static 'vendor/jquery/jquery.js' %}"></script>
    <script src="{% static 'vendor/popper/popper.js' %}"></script>
    <script src="{% static 'vendor/bootstrap/js/bootstrap.js' %}"></script>

    {% endblock %}
</body>
</html>